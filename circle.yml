machine:
  ruby:
    version: 2.3.0
  environment:
    DB_USER: ubuntu
    DB_NAME: circle_test
    SAUCE_USERNAME: torbjoernk
    COVERALLS_PARALLEL: true

dependencies:
  bundler:
    without: [headfultest]
  post:
    - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    - tar -xzf sc-latest-linux.tar.gz

test:
  override:
    - cd sc-*-linux && ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY:
        background: true
    - ./circleci.sh:
        parallel: true

notify:
  webhooks:
    - url: https://coveralls.io/webhook?repo_token=$COVERALLS_REPO_TOKEN
